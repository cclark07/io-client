!function(){window.muutio=function(r,o,a){if(n(o)){a=o;o={}}o=o||{};var s=e({},["ready","close","reconnect"]),c=o.host||"https://client-api.muut.com",f=navigator.onLine;if(f===undefined)f=true;s.session=o.session||{sessionId:localStorage["jsonrpc.session"]};s.call=function(t){if(!f)throw"not connected";var r={method:t,session:s.session,transport:"ajax"},o=[].slice.call(arguments),a=o.slice(1,-1),u=o.slice(-1)[0];if(!n(u)){if(u!==undefined)a=o.slice(1);u=undefined}r.params=a;s.emit("send",t,r.params);var p=a&&a[0]&&a[0].files,d=e({},["done","fail","always"]);d.done(function(e){u&&u.call(s,e.result)});if(window.File&&p){delete a[0].files;l(d,r,p)}else{i(c,r,function(e){s.emit("receive",e,t);if(e.error)d.fail(e.error);else d.done(e);d.always(e)})}return d};function l(e,n,t){var i=new FormData;t.forEach(function(e){i.append(e.altname||e.name,e)});i.append("jsonrpc",JSON.stringify(n));var r=new XMLHttpRequest;r.onload=function(n){var t=JSON.parse(n.target.response);e.emit("done",t).emit("always",n)};r.onerror=function(n){e.emit("fail",n).emit("always",n)};r.open("POST",c);r.send(i)}function u(e){if(e&&e.sessionId&&e.channelId){s.session=t({},e);try{localStorage["jsonrpc.session"]=e.sessionId}catch(n){}}}s.on("receive",function(e,n){u(e.session);if(n=="init"){m();u(e.session);s.time_offset=Date.now()-e.server_time*1e3;s.ready(e.result)}});s.start=function(e,n){s.call("init",e,function(e){n&&n.call(s,e);var t=!navigator.userAgent.toLowerCase().split("googlebot")[1]&&o.poll!==false;if(s.session&&t){try{if(window.EventSource)y();else S()}catch(i){console.error(i.stack||i);S()}}})};var p;if(navigator.onLine!==undefined){setInterval(function(){var e=navigator.onLine;if(e!=f){s.emit(e?"online":"offline");f=e}var n=p&&Date.now()-p;if(n>60*1e3&&f){p=Date.now();setTimeout(v,2e3)}},272)}function d(e){p=Date.now();if(!e||e=="ok"||e=="ping")return;var n=e.error||e.params&&e.params.error;if(!n){s.emit("receive",e);s.emit.apply(s,e.params)}else if(n=="error_invalid_channel"){v()}else{throw n}}function m(){delete s.session.channelId;if(g&&g.readyState==1){g.close();s.emit("close")}else if(w&&w.readyState==1){w.abort();s.emit("close")}}function v(){m();s.emit("reconnect")}function h(){var e=1+Math.round(Math.random()*2);return c.replace("client-api","events-"+e)}var g;function y(){var e=s.session;if(!e.channelId)return;g=new EventSource(h()+"/sse/"+e.sessionId+"/"+e.channelId);g.onmessage=function(e){d(JSON.parse(e.data))};g.onerror=function(e){g.close();setTimeout(y,2700)}}var w;function S(){if(!s.session.channelId)return;var e=t({transport:"ajax"},s.session);w=i(h()+"/notifications",e,function(e){d(e);if(e.error)w.abort();else S()}).fail(function(e,n){setTimeout(S,2700);try{w.abort()}catch(t){}})}s.start({path:"/"+r},a);return s};function e(e,i){var r=[].slice,o={};t(e,{on:function(t,i,r){t=t.split(" ");if(n(i)){r=i;i=0}if(n(r)){for(var a=0,s=t.length,c;a<s;a++){c=t[a].trim();(o[c]=o[c]||[]).push(r);if(s>1||t=="*")r.typed=true}if(i)r.typed?r("inline",i):r(i)}return e},off:function(n,t){if(n=="*")return o={};n=n.split(" ");for(var i=0,r;i<n.length;i++){r=n[i].trim();if(!t){o[r]=[];continue}var a=o[r]||[],s=-1;for(var c=0,f=a.length;c<f;c++){if(a[c]===t||a[c].listener===t){s=c;break}}if(s>=0)a.splice(s,1)}return e},one:function(t,i){function r(){e.off(t,i);i.apply(e,arguments)}if(n(i)){r.listener=i;e.on(t,r)}return e},emit:function(n){var t=r.call(arguments,1),i=o[n]||[],a=o["*"];if(a)i=i.concat(a);for(var s=0,c=i.length,f,l,u;s<c;++s){f=i[s];if(!f)continue;u=f.typed?[n].concat(t):t;if(f.apply(e,u)===false)return e}return e}});i.forEach(function(t){e[t]=function(i){return n(i)?e.on(t,i):e.emit.apply(e,[t].concat(r.call(arguments)))}});return e}function n(e){return typeof e=="function"}function t(e,n){n&&Object.keys(n).forEach(function(t){e[t]=n[t]});return e}function i(e,n,t){var i=new XMLHttpRequest;i.onload=function(e){t(JSON.parse(e.target.response))};i.open("POST",e);var r=JSON.stringify(n).replace(/\?\?/g,"?&quest;");i.send(r);return i}}();