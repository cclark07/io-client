<!DOCTYPE html>

<head>
  <title>Authentication</title>
  <style>

    body {
      margin: 5%;
      text-align: center;
    }
    button {
      font-family: sans-serif;
      font-size: inherit;
      padding: 1em 2em;
    }
  </style>
</head>

<body>

  <button id="auth" disabled>Log in</button>


  <script src="../muutio.js"></script>

  <script>
  // opens an URL on the center of the screen
  function openWindow(url, width, height) {
     var w = window,
        left = (w.screenX || w.screenLeft) + (w.outerWidth - width) / 2,
        top = (w.screenY || w.screenTop) + 50,
        opts = "left=" +left+ ",top=" +top+ ",status=0,scrollbars=0,menubar=0";

     w.open(url, "moot_popup", opts + ",width=" +width+ ",height=" +height).focus();
  }

  // 'https://devapi.muut.com'
  muutio('playground', { host: 'https://devapi.muut.com' }, function(data) {

    var self = this

    // button click handler
    var btn = document.getElementById('auth')

    btn.disabled = false

    btn.addEventListener('click', function() {

      // construct authentication URL
      var url = 'https://devapp.muut.com/account/auth/login/?path=/playground'

      var sess = self.session
      url += '&sessionId=' + sess.sessionId
      url += '&channelId=' + sess.channelId

      openWindow(url, 800, 700)
    })

    // receive event upon succesfull login
    this.on('login', function() {
      alert('You are logged in')
    })

  })
  </script>

</body>